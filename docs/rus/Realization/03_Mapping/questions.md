# Вопросы: Этап 3 Маппинг

| ID | Категория | Вопрос | Статус | Ответ |
|----|-----------|--------|--------|-------|
| MQ1 | Users | Нужно ли обновлять маппинг при изменении email? | closed | B: Обновляем поле email в существующей записи IdMap (без версий). |
|  |  | Пример: user 123 email изменился с a@x.com на b@x.com после первоначального импорта — обновляем запись IdMap или создаём версионную историю? | note | История не ведётся; аудит через логи изменений. |
| MQ2 | Tasks | Нужно ли маппить кастомные поля задач или перенос 1:1? | closed | A: Auto-create всех нужных кастомных полей / enum в on-prem (зеркало Cloud). |
|  |  | Пример: поле UF_TASK_FLAG (enum) отсутствует в on-prem. Стратегия: auto-create enum, преобразовать в string, или пропуск с логом? | note | Создаём недостающее поле / значения перед импортом. |
| MQ3 | Timezone | Отдаёт ли on-prem API локальные или UTC даты? | closed | D: Универсально сохраняем raw + UTC + offset (оптимизация до A, если подтвердится чистый UTC). |
|  |  | Пример: если on-prem возвращает локальное время + offset, можем ли отказаться от OriginalOffset? | note | Нет, пока используем тройку полей rawTimestamp/utc/offsetMinutes. |
| MQ4 | CRM | Какие сущности CRM войдут в первую волну? | closed | D: Последовательное поочерёдное тестирование и импорт каждой сущности (Companies → Contacts → Deals → SmartProcess) с отдельной верификацией. |
|  |  | Пример: Волна 1 (Companies, Contacts, Deals) Волна 2 (SmartProcess). Подтвердить. | note | Строгая последовательность для полной контроля; каждая фаза gated по success_ratio. |
| MQ5 | Consistency | Требуется ли soft-lock на время построения маппинга? | closed | A: Жёсткий soft-lock — зависимые импорты ждут coverage users mapping ≥98%. |
|  |  | Пример: заморозить импорт задач пока не завершён users mapping coverage >=98% (metric). | note | Метрика mapping.users.coverage контролирует снятие блокировки. |

History:
- scaffold
- decisions applied (MQ1=B, MQ2=A, MQ3=D, MQ4=seq, MQ5=A)

## Решения и последствия (кратко)
MQ1: Простота, нет версионности — если понадобится аудит, добавим EmailChange events.
MQ2: Полнота данных, риск разрастания схемы — требуется контроль naming.
MQ3: Универсальная модель минимизирует риск рассинхронизации; доп. хранение нескольких полей.
MQ4: Минимизируем сложность диагностики; увеличиваем общее время до полной доступности всех CRM сущностей.
MQ5: Гарантируем целостные ссылки; удлиняем старт зависимых импортов.
